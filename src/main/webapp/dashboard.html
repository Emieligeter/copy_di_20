<!DOCTYPE HTML>

<html lang=”en”>
<head>
<title>SUMO Dashboard</title>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=yes">
<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
	integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
	crossorigin="anonymous">
<link rel="stylesheet" type="text/css"
	href="http://www.shieldui.com/shared/components/latest/css/light/all.min.css" />
</head>

<body>
	<div class="container">
		<div class="row">
			<div id=elementButtons class="col">
				<button id="LineGraph" class="btn btn-outline-primary" onclick="setChartType('line')">Line Graph</button> 
				<button id="ScatterPlot" class="btn btn-outline-primary" onclick="setChartType('scatter')">Scatter Plot</button> 
				<button id="BarChart" class="btn btn-outline-primary" onclick="setChartType('bar')">Bar Chart</button>
				<button id="PieChart" class="btn btn-outline-primary" onclick="setChartType('pie')">Pie Chart</button> 
				 
				<button id="addToReport" class="btn btn-success" onclick="chartToReport()">Add chart to report</button>
				<br>
			</div>
		</div>
		<div class="row">
			<div id="fileSelect" class="col">
				<button id=toSimList class="btn btn-secondary" onclick="location.href='simList.html'">Edit Files</button>
				<p>this is where we have a list of files</p>
			</div>
			<div id="chart" class="col">
				<canvas id="myChart"></canvas>
			</div>
			<div id="varSelect" class="col">
				<div id="fstChoice">
				<label class="row"  for="first-choice">Choose a plot:</label>
				<select id="first-choice" name="plotChoice" class="form-control row" onchange="changeSecondChoice()" required>
					<option selected value="base">Please choose a plot</option>
					<option value="Edge appearance frequency">Edge appearance frequency</option>
					<option value="Number of lane transiting vehicles">Number of lane transiting vehicles</option>
					<option value="Average route length">Average route length</option>
					<option value="Route length">Route length</option>
					<option value="Speed">Speed</option>
					<option value="Speed factor">Speed factor</option>
					<option value="Average route length">Average route length</option>
					<option value="Average vehicle speed">Average vehicle speed</option>
					<option value="Average vehicle speed factor">Average vehicle speed factor</option>
					<option value="Cumulative number of arrived vehicles">Cumulative number of arrived vehicles</option>
					<option value="Number of transferred vehicles">Number of transferred vehicles</option>
					<option value="Number of running vehicles">Number of running vehicles</option>
					<option value="Cumulative number of arrived vehicles">Cumulative number of arrived vehicles</option>
					<option value="Number of running vehicles">Number of running vehicles</option>
				</select>
				</div>
				<div id="optionalSecChoice" class="row">
				</div>
				<div id="editChartStyle">
					<label class="row"  for="editChart">Edit chart:</label>
					<form class="row" name="editChart" id="editChart" data-toggle="buttons">
		     				
	     				<label class="btn btn-primary active form-check-label">
	       				<input class="form-check-input" type="radio" checked autocomplete="off" style="opacity: 0" name="editChart" value="title"> Title
	     				</label>
	
	     				<label class="btn btn-primary form-check-label">
	      					<input class="form-check-input" type="radio" autocomplete="off" style="opacity: 0" name="editChart" value="y-axis"> Y-axis
	     				</label>
	
	     				<label class="btn btn-primary form-check-label">
	       				<input class="form-check-input" type="radio" autocomplete="off" style="opacity: 0" name="editChart" value="x-axis"> X-axis
	     				</label>
	     				
	     				<label class="btn btn-primary form-check-label">
	       				<input class="form-check-input" type="radio" autocomplete="off" style="opacity: 0" name="editChart" value="color"> Color
	     				</label>
	     				
	     				</form>
	     			</div>
	     			<div id="enterData" class="row">
	   					<input type="text" class="form-control" id="setTitleInput" placeholder="Chart 1">
						<button type="submit" class="btn btn-outline-success" onClick="editChartStyle('change')">Submit</button>		   			
						<button type="button" class="btn btn-outline-danger" onClick="editChartStyle('remove')">Remove</button>		   			
					</div>	   			
				</div>
			</div>
		</div>
		<div class="row">
			<div id="report" class="col">
			<h3>Preliminary report</h3>
			</div>
		</div>
	</div>


		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
			integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
			crossorigin="anonymous"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
			integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
			crossorigin="anonymous"></script>
		<script
			src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
			integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
			crossorigin="anonymous"></script>
		<script type="text/javascript" src="htmlFunctions.js"></script>
		<script type="text/javascript" src="chartFunctions.js"></script>
		
		
		
		
		<script>
		function getCtx() {
			return document.getElementById('myChart').getContext('2d');
		}
		
		function chartToReport() {
			console.log("lets add this chart to the report.")
			var chart = copyCanvas(document.getElementById('myChart'));
			document.getElementById('report').appendChild(chart);
			console.log("done.")
		}
		
		function copyCanvas(original) {
			var newThing = document.createElement('canvas');
			var cxt = newThing.getContext('2d');
			newThing.width = original.width;
			newThing.height = original.height;
			cxt.drawImage(original, 0, 0);
			return newThing;
		}
		
		var chart;
		var chartType = "line";
		function setChartType(type) {
			chartType = type;
			console.log("Set chartType to " + type + chartType);
			updateChart();
		}
		
		function updateChart() {
			console.log("We're going to update the chart to type " + chartType);
			if (this.chart!==undefined){this.chart.destroy();}
			var canvas = document.getElementById('myChart');
			var ctx = canvas.getContext('2d');
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			chart = new Chart(ctx, {
				// The type of chart we want to create
				type : chartType,

				// The data for our dataset
				data : {
					labels : [ "January", "February", "March", "April", "May",
							"June", "July" ],
					datasets : [ {
						label : "My First dataset",
						fill : false,
						backgroundColor : getColors(7),
						borderColor : 'rgb(99, 99, 132)',
						data : [ 0, 10, 5, 2, 20, 30, 45 ],
						
					} ]
				},

				// Configuration options go here
				options : {}
			});
			console.log("done.");
		}
		
		/*https://stackoverflow.com/questions/28828915/how-set-color-family-to-pie-chart-in-chart-js*/
		function getColors(length){
		    let pallet = ["#0074D9", "#FF4136", "#2ECC40", "#FF851B", "#7FDBFF", "#B10DC9", "#FFDC00", "#001f3f", "#39CCCC", "#01FF70", "#85144b", "#F012BE", "#3D9970", "#111111", "#AAAAAA"];
		    let colors = [];

		    for(let i = 0; i < length; i++) {
		      colors.push(pallet[i % pallet.length]);
		    }

		    return colors;
		  }
		
		function editChartStyle(type){
			var checked = document.querySelector('input[name="editChart"]:checked').value;
			switch(checked) {
			case 'title':
				if (type === "remove") {
					chart.options.title.display = false;
				} else if (type === "change"){
				var newTitle = document.getElementById("setTitleInput").value;
				chart.options.title.text = newTitle;
				chart.options.title.display = true;
				}
				break;
			case 'y-axis':
				if (type === "remove") {
					chart.options.scales.yAxes[0].scaleLabel.display = false;
				} else if (type === "change"){
				var newTitle = document.getElementById("setTitleInput").value;
				chart.options.scales.yAxes[0].scaleLabel.labelString = newTitle;
				chart.options.scales.yAxes[0].scaleLabel.display = true;
				}
				break;
			case 'x-axis':
				if (type === "remove") {
					chart.options.scales.xAxes[0].scaleLabel.display = false;
				} else if (type === "change"){
				var newTitle = document.getElementById("setTitleInput").value;
				chart.options.scales.xAxes[0].scaleLabel.labelString = newTitle;
				chart.options.scales.xAxes[0].scaleLabel.display = true;
				}
				break;
			case 'color':
				if (type === "change"){
				var newColor = document.getElementById("setTitleInput").value;
				chart.data.datasets[0].borderColor = newColor;
				chart.data.datasets[0].backgroundColor = newColor;
				}
				break;
			}
			chart.update();
			}
		
		var dropDownOptions = {};
		dropDownOptions['Edge appearance frequency'] = ['Edge 1', 'Edge 2', 'Edge 3'];
		dropDownOptions['Number of lane transiting vehicles'] = ['Lane 1', 'Lane 2', 'Lane 3'];
		dropDownOptions['Route length'] = ['Vehicle 1', 'Vehicle 2', 'Vehicle 3'];
		dropDownOptions['Speed'] = ['Vehicle 1', 'Vehicle 2', 'Vehicle 3'];
		dropDownOptions['Speed factor'] = ['Vehicle 1', 'Vehicle 2', 'Vehicle 3'];

		function changeSecondChoice() {
		    var fst = document.getElementById("first-choice");
		    var sec = document.getElementById("second-choice");
		    if (sec == null) {
		    	document.getElementById("optionalSecChoice").innerHTML = "<select id=\"second-choice\" name=\"detailChoice\" class=\"form-control\"></select>";
		    	sec = document.getElementById("second-choice");
		    	}
		    var chosen = fst.options[fst.selectedIndex].value;
		    while (sec.options.length) {
		        sec.remove(0);
		    }
		    var options = dropDownOptions[chosen];
		    if (options) {
		        var i;
		        for (i = 0; i < options.length; i++) {
		            var option = new Option(options[i], i);
		            sec.options.add(option);
		        }
		    } else {
		    	document.getElementById("optionalSecChoice").innerHTML = "";
		    }
		} 
		</script>
</body>